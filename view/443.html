<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
<meta name="renderer" content="webkit" /> <!-- 让360支持高速渲染模式 -->
<meta http-equiv="pragma" content="no-cache" /> 
<meta http-equiv="Cache-Control" content="no-store, must-revalidate" /> 
<meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT" /> 
<meta http-equiv="expires" content="0" />
<link rel="shortcut icon" href="/favicon.ico?v=1.2" />
<link href="/templets/default/style/common.css?v=1.2" rel="stylesheet" />
<title>C语言scanf的高级用法，原来scanf还有这么多新技能</title>
<meta name="keywords" content="语言,scanf,的,高级,用法,原来,还有,这么,多新," />
<meta name="description" content="在前面几节中，我们演示了如何使用 scanf() 来读取各种各样的数据，汇总了 scanf() 可以使用的格式控制符，然后还讲解了缓冲区，从根本上消除了 scanf() 的那些奇怪行为，至此，很多初" />
</head>
<body>
<div id="header" class="clearfix">
	<a id="logo" class="left" href="/">
		<img height="26" src="/templets/default/images/logo_monkey.png" alt="数据结构与算法教程Logo" />
	</a>
	<ul id="nav-main" class="hover-none left clearfix">
		<li><a href="/">教程首页</a></li>
		<li><a href="/view/212.html">购买教程</a></li>
		<!--<li><a href="/c/">辅导班</a></li>-->
	</ul>
	<span id="sidebar-toggle" class="toggle-btn" toggle-target="#sidebar">目录 <span class="glyphicon"></span></span>
</div>
<!--qq交流群
<div id="header" class="clearfix">
	<ul id="nav-main" class="hover-none left clearfix">
		<li><a style="padding-left:10px" href="/uploads/allimg/240128/2-24012R01153206.jpg" target="_blank">QQ交流群：937184979</a></li>
	</ul>
</div>-->
<div id="main" class="clearfix">
	<div id="sidebar" class="toggle-target">
	<div id="contents">
		<dt><span class="glyphicon glyphicon-option-vertical" aria-hidden="true"></span>教程目录</dt>
		
			<dd>
				<span class="channel-num">1</span>
				<a href='/c/base/'>编程基础</a>
			</dd>
		
			<dd>
				<span class="channel-num">2</span>
				<a href='/c/begin/'>C语言初探</a>
			</dd>
		
			<dd>
				<span class="channel-num">3</span>
				<a href='/c/variable_datatype/'>变量和数据类型</a>
			</dd>
		<dd class="this"> <span class="channel-num">4</span> <a href="/c/io/">C语言输入输出</a> </dd><dl class="dl-sub"><dd>4.1 <a href="/view/436.html">数据输出大汇总以及轻量进阶</a></dd><dd>4.2 <a href="/view/437.html">在屏幕的任意位置输出字符，开发小游戏的第一步</a></dd><dd>4.3 <a href="/view/438.html">使用scanf读取从键盘输入的数据</a></dd><dd>4.4 <a href="/view/439.html">从键盘输入字符和字符串</a></dd><dd>4.5 <a href="/view/440.html">进入缓冲区的世界，破解一切与输入输出有关的疑难杂症</a></dd><dd>4.6 <a href="/view/441.html">结合缓冲区谈scanf函数，那些奇怪的行为其实都有章可循</a></dd><dd>4.7 <a href="/view/442.html">清空（刷新）缓冲区，从根本上消除那些奇怪的行为</a></dd><dd>4.8 <a href="/view/443.html">scanf的高级用法，原来scanf还有这么多新技能</a></dd><dd>4.9 <a href="/view/444.html">C语言模拟密码输入(显示星号)</a></dd><dd>4.10 <a href="/view/445.html">非阻塞式键盘监听，用户不输入数据程序也能继续执行</a></dd></dl>
			<dd>
				<span class="channel-num">5</span>
				<a href='/c/branch_loop/'>循环结构和选择结构</a>
			</dd>
		
			<dd>
				<span class="channel-num">6</span>
				<a href='/c/array/'>C语言数组</a>
			</dd>
		
			<dd>
				<span class="channel-num">7</span>
				<a href='/c/function/'>C语言函数</a>
			</dd>
		
			<dd>
				<span class="channel-num">8</span>
				<a href='/c/preprocess/'>预处理命令</a>
			</dd>
		
			<dd>
				<span class="channel-num">9</span>
				<a href='/c/pointer/'>指针</a>
			</dd>
		
			<dd>
				<span class="channel-num">10</span>
				<a href='/c/struct/'>结构体</a>
			</dd>
		
			<dd>
				<span class="channel-num">11</span>
				<a href='/c/file/'>文件操作</a>
			</dd>
		
			<dd>
				<span class="channel-num">12</span>
				<a href='/c/debug/'>C语言调试</a>
			</dd>
		
			<dd>
				<span class="channel-num">13</span>
				<a href='/c/memory/'>C语言内存精讲</a>
			</dd>
		
			<dd>
				<span class="channel-num">14</span>
				<a href='/c/module/'>多文件编程</a>
			</dd>
		
			<dd>
				<span class="channel-num">15</span>
				<a href='/c/practice/'>C语言项目实战案例</a>
			</dd>
		
	</div>
</div>
	<div id="article-wrap">
		<div id="article">
			<h1>C语言scanf的高级用法，原来scanf还有这么多新技能</h1>
			<div class="pre-next-page pre-next-detail clearfix">
                    <span class="pre left"><span class="glyphicon glyphicon-menu-left"></span> <a href="/view/442.html">清空（刷新）缓冲区，从根本上消除那些奇怪的行为</a></span>
                    <span class="next right"><a href="/view/444.html">C语言模拟密码输入(显示星号)</a> <span class="glyphicon glyphicon-menu-right"></span></span>
                </div>
                <div class="pre-next-page pre-next-brief clearfix">
                    <span class="pre left"><span class="glyphicon glyphicon-menu-left"></span> <a href="#">上一节</a></span>
                    <span class="next right"><a href="#">下一节</a> <span class="glyphicon glyphicon-menu-right"></span></span>
                </div>
                <script type="text/javascript">window.prePageURL = "/view/442.html";window.nextPageURL = "/view/444.html";</script>
			<div id="arc-body">在前面几节中，我们演示了如何使用 scanf() 来读取各种各样的数据，汇总了 scanf() 可以使用的格式控制符，然后还讲解了缓冲区，从根本上消除了 scanf() 的那些奇怪行为，至此，很多初学者就认为自己已经完全掌握了 scanf()。<br />
<br />
其实，这只是 scanf() 的基本用法，每个C语言程序员都应该掌握，如果你想让自己的输入更加炫酷、更加个性化、更加安全，那么还需要学习 scanf() 的高级用法，这才是大神和菜鸟的分水岭。<br />
<br />
好了，言归正传，我们分三个方面讲解 scanf() 的高级用法。
<h2>
	1) 指定读取长度</h2>
还记得在 printf() 中可以指定最小输出宽度吗？就是在格式控制符的中间加上一个数字，例如，<code>%10d</code>表示输出的整数至少占用 10 个字符的位置：
<ul>
	<li>
		如果整数的宽度不足 10，那么在左边以空格补齐；</li>
	<li>
		如果整数的宽度超过了 10，那么以整数本身的宽度来输出，10 不再起作用。</li>
</ul>
<br />
其实，scanf() 也有类似的用法，也可以在格式控制符的中间加一个数字，用来表示读取数据的最大长度，例如：<br />
<code>%2d</code>表示最多读取两位整数；<br />
<code>%10s</code>表示读取的字符<u><a href='/view/175.html' target='_blank'>串</a></u>的最大长度为 10，或者说，最多读取 10 个字符。<br />
<br />
请看下面的例子：
<pre class="cpp">
#include &lt;stdio.h&gt;

int main(){
    int n;
    float f;
    char str[27];

    scanf(&quot;%2d&quot;, &amp;n);
    scanf(&quot;%*[^\n]&quot;); scanf(&quot;%*c&quot;);  //清空缓冲区
    scanf(&quot;%5f&quot;, &amp;f);
    scanf(&quot;%*[^\n]&quot;); scanf(&quot;%*c&quot;);  //清空缓冲区
    scanf(&quot;%26s&quot;, str);
    printf(&quot;n=%d, f=%g, str=%s\n&quot;, n, f, str);

    return 0;
}</pre>
输入示例 ①：
<p class="info-box">
	20↙<br />
	100.5↙<br />
	https://xiexuewu.github.io↙<br />
	n=20, f=100.5, str=https://xiexuewu.github.io</p>
输入示例 ②：
<p class="info-box">
	8920↙<br />
	10.2345↙<br />
	https://xiexuewu.github.ioabc↙<br />
	n=89, f=10.23, str=https://xiexuewu.github.io</p>
这段代码使用了多个 scanf() 函数连续读取数据，为了避免受到缓冲区中遗留数据的影响，每次读取结束我们都使用<code>scanf(&quot;%*[^\n]&quot;); scanf(&quot;%*c&quot;);</code>来清空缓冲区。<br />
<br />
限制读取数据的长度在实际开发中非常有用，最典型的一个例子就是读取字符串：我们为字符串分配的内存是有限的，用户输入的字符串过长就存放不了了，就会冲刷掉其它的数据，从而导致程序出错甚至崩溃；如果被黑客发现了这个漏洞，就可以构造<u><a href='/view/169.html' target='_blank'>栈</a></u>溢出攻击，改变程序的执行流程，甚至执行自己的恶意代码，这对服务器来说简直是灭顶之灾。<br />
<br />
在用 gets() 函数读取字符串的时候，有一些编译器会提示不安全，建议替换为 gets_s() 函数，就是因为 gets() 不能控制读取到的字符串的长度，风险极高。<br />
<br />
就目前学到的知识而言，虽然 scanf() 可以控制字符串的长度，但是字符串中却不能包含空白符，这是硬伤，所以 scanf() 暂时还无法替代 gets()。不过大家也不要着急，稍后我还会补充 scanf() 的高级用法，届时 scanf() 就可以完全替代 gets()，并且比 gets() 更加智能。
<h2>
	2) 匹配特定的字符</h2>
%s 控制符会匹配除空白符以外的所有字符，它有两个缺点：
<ul>
	<li>
		%s 不能读取特定的字符，比如只想读取小写字母，或者十进制数字等，%s 就无能为力；</li>
	<li>
		%s 读取到的字符串中不能包含空白符，有些情况会比较尴尬，例如，无法将多个单词存放到一个字符串中，因为单词之间就是以空格为分隔的，%s 遇到空格就读取结束了。</li>
</ul>
<br />
要想解决以上问题，可以使用 scanf() 的另外一种字符匹配方式，就是<code>%[xxx]</code>，<code>[ ]</code>包围起来的是需要读取的字符集合。例如，<code>%[abcd]</code>表示只读取字符<code>abcd</code>，遇到其它的字符就读取结束；注意，这里并不强调字符的顺序，只要字符在 abcd 范围内都可以匹配成功，所以你可以输入 abcd、dcba、ccdc、bdcca 等。<br />
<br />
请看下面的代码：
<pre class="cpp">
#include &lt;stdio.h&gt;
int main(){
    char str[30];
    scanf(&quot;%[abcd]&quot;, str);
    printf(&quot;%s\n&quot;, str);

    return 0;
}</pre>
输入示例 ①：
<p class="info-box">
	abcdefgh↙<br />
	abcd</p>
输入示例 ②：
<p class="info-box">
	baccbaxyz↙<br />
	baccba</p>
<h4>
	使用连接符</h4>
为了简化字符集合的写法，scanf() 支持使用连字符<code>-</code>来表示一个范围内的字符，例如 %[a-z]、%[0-9] 等。<br />
<br />
连字符左边的字符对应一个 ASCII 码，连字符右边的字符也对应一个 ASCII 码，位于这两个 ASCII 码范围以内的字符就是要读取的字符。注意，连字符左边的 ASCII 码要小于右边的，如果反过来，那么它的行为是未定义的。<br />
<br />
常用的连字符举例：
<ul>
	<li>
		<code>%[a-z]</code>表示读取 abc...xyz 范围内的字符，也即小写字母；</li>
	<li>
		<code>%[A-Z]</code>表示读取 ABC...XYZ 范围内的字符，也即大写字母；</li>
	<li>
		<code>%[0-9]</code>表示读取 012...789 范围内的字符，也即十进制数字。</li>
</ul>
<br />
你也可以将它们合并起来，例如：
<ul>
	<li>
		<code>%[a-zA-Z]</code>表示读取大写字母和小写字母，也即所有英文字母；</li>
	<li>
		<code>%[a-z-A-Z0-9]</code>表示读取所有的英文字母和十进制数字；</li>
	<li>
		<code>%[0-9a-f]</code>表示读取十六进制数字。</li>
</ul>
<br />
请看下面的演示：
<pre class="cpp">
#include &lt;stdio.h&gt;
int main(){
    char str[30];
    scanf(&quot;%[a-zA-Z]&quot;, str);  //只读取字母
    printf(&quot;%s\n&quot;, str);
    return 0;
}</pre>
输入示例：
<p class="info-box">
	abcXYZ123↙<br />
	abcXYZ</p>
<h4>
	不匹配某些字符</h4>
假如现在有一种需求，就是读取换行符以外的所有字符，或者读取 0~9 以外的所有字符，该怎么实现呢？总不能把剩下的字符都罗列出来吧，一是麻烦，二是不现实。<br />
<br />
C语言的开发者们早就考虑到这个问题了，scanf() 允许我们在<code>%[ ]</code>中直接指定某些不能匹配的字符，具体方法就是在不匹配的字符前面加上<code>^</code>，例如：
<ul>
	<li>
		<code>%[^\n]</code>表示匹配除换行符以外的所有字符，遇到换行符就停止读取；</li>
	<li>
		<code>%[^0-9]</code>表示匹配除十进制数字以外的所有字符，遇到十进制数字就停止读取。</li>
</ul>
<br />
请看下面的例子：
<pre class="cpp">
#include &lt;stdio.h&gt;
int main(){
    char str1[30], str2[30];
    scanf(&quot;%[^0-9]&quot;, str1);
    scanf(&quot;%*[^\n]&quot;); scanf(&quot;%*c&quot;);  //清空缓冲区
    scanf(&quot;%[^\n]&quot;, str2);
    printf(&quot;str1=%s \nstr2=%s\n&quot;, str1, str2);

    return 0;
}</pre>
输入示例：
<p class="info-box">
	abcXYZ@#87edf↙<br />
	c c++ java python go javascript↙<br />
	str1=abcXYZ@#<br />
	str2=c c++ java python go javascript</p>
请注意第 6 行代码，它的作用是读取一行字符串，和 gets() 的功能一模一样。你看，scanf() 也能读取带空格的字符串呀，谁说 scanf() 不能完全取代 gets()，这明显是错误的说法。<br />
<br />
另外，scanf() 还可以指定字符串的最大长度，指定字符串中不能包含哪些字符，这是 gets() 不具备的功能。<br />
<br />
例如，读取一行不能包含十进制数字的字符串，并且长度不能超过 30：
<pre class="cpp">
#include &lt;stdio.h&gt;
int main(){
    char str[31];
    scanf(&quot;%30[^0-9\n]&quot;, str);
    printf(&quot;str=%s\n&quot;, str);
   
    return 0;
}</pre>
输入示例 ①：
<p class="info-box">
	https://xiexuewu.github.io xiexuewu↙<br />
	str=https://xiexuewu.github.io xie</p>
输入示例 ②：
<p class="info-box">
	I have been programming for 8 years.↙<br />
	str=I have been programming for&nbsp;</p>
总之，scanf() 不仅可以完全替代 gets()，并且比 gets() 的功能更加强大。
<h2>
	3) 丢弃读取到的字符</h2>
在前面的代码中，每个格式控制符都要对应一个变量，把读取到的数据放入对应的变量中。其实你也可以不这样做，scanf() 允许把读取到的数据直接丢弃，不往变量中存放，具体方法就是在 % 后面加一个<code>*</code>，例如：
<ul>
	<li>
		<code>%*d</code>表示读取一个整数并丢弃；</li>
	<li>
		<code>%*[a-z]</code>表示读取小写字母并丢弃；</li>
	<li>
		<code>%*[^\n]</code>表示将换行符以外的字符全部丢弃。</li>
</ul>
<br />
请看下面的代码演示：
<pre class="cpp">
#include &lt;stdio.h&gt;
int main(){
    int n;
    char str[30];
    scanf(&quot;%*d %d&quot;, &amp;n);
    scanf(&quot;%*[a-z]&quot;);
    scanf(&quot;%[^\n]&quot;, str);
    printf(&quot;n=%d, str=%s\n&quot;, n, str);

    return 0;
}</pre>
输入示例：
<p class="info-box">
	100 999abcxyzABCXYZ↙<br />
	n=999, str=ABCXYZ</p>
对结果的分析：整数 100 被第一个 scanf() 中的<code>%*d</code>读取后丢弃了，整数 999 被第<code>%d</code>读取到，并赋值给 n。此时缓冲区中剩下&nbsp;abcxyzABCXYZ，第二个 scanf() 将 abcxyz 读取并丢弃，剩下的 ABCXYZ 被最后一个 scanf() 读取到并赋值给 str。<br />
<br />
大家有没有意识到，将读取到的字符直接丢弃，这就是在清空输入缓冲区呀，虽然有点蹩脚，但是行之有效。在《<a href="/view/442.html" target="_blank">清空（刷新）缓冲区，从根本上消除那些奇怪的行为</a>》一节中，我们已经给出了使用 scanf() 清空缓冲区的方案，就是：
<p class="info-box">
	scanf(&quot;%*[^\n]&quot;); scanf(&quot;%*c&quot;);</p>
下面我们就来解释一下。<br />
<br />
首先需要明白的是，等到需要清空缓冲区的时候，缓冲区中的最后一个字符一定是换行符<code>\n</code>，因为输入缓冲区是行缓冲模式，用户按下回车键会产生换行符，结束本次输入，然后输入函数开始读取。<br />
<br />
<code>scanf(&quot;%*[^\n]&quot;);</code>将换行符前面的所有字符清空，<code>scanf(&quot;%*c&quot;);</code>将最后剩下的换行符清空。<br />
<br />
有些网友将这两条语句合并起来，写作：
<p class="info-box">
	scanf(&quot;%*[^\n]%*c&quot;);</p>
这是错误的。合并以后的语句不能清空单个换行符，因为该语句要求换行符前边至少要有一个其它的字符，单个换行符会导致匹配失败。
<h2>
	总结</h2>
scanf() 控制字符串的完整写法为：
<p class="info-box">
	%{*} {width} type</p>
其中，{ } 表示可有可无。各个部分的具体含义是：
<ul>
	<li>
		<code>type</code>表示读取什么类型的数据，例如 %d、%s、%[a-z]、%[^\n] 等；type 必须有。</li>
	<li>
		<code>width</code>表示最大读取宽度，可有可无。</li>
	<li>
		<code>*</code>表示丢弃读取到的数据，可有可无。</li>
</ul>
</div>
			<div class="pre-next-page pre-next-detail clearfix">
                    <span class="pre left"><span class="glyphicon glyphicon-menu-left"></span> <a href="/view/442.html">清空（刷新）缓冲区，从根本上消除那些奇怪的行为</a></span>
                    <span class="next right"><a href="/view/444.html">C语言模拟密码输入(显示星号)</a> <span class="glyphicon glyphicon-menu-right"></span></span>
                </div>
                <div class="pre-next-page pre-next-brief clearfix">
                    <span class="pre left"><span class="glyphicon glyphicon-menu-left"></span> <a href="#">上一节</a></span>
                    <span class="next right"><a href="#">下一节</a> <span class="glyphicon glyphicon-menu-right"></span></span>
                </div>
                <script type="text/javascript">window.prePageURL = "/view/442.html";window.nextPageURL = "/view/444.html";</script>
		</div>
		
	</div>
</div>
<div id="addweixin-widget" class="clearfix">
	<div class="box">
		<p>
			<a href="/uploads/allimg/240115/2-240115210631414.png" target="_blank"><img src="/uploads/allimg/240115/2-240115210631414.png" alt="添加微信咨询" title="点击查看大图"></a>
			<span class="pc-tip">添加管理员微信<br/>免费领视频教程</span>
			<span class="wap-tip">加管理员微信免费领视频教程<br>微信ID：xiexuewu333</span>
		</p>
		<span id="close-addweixin-widget" class="glyphicon glyphicon-remove-circle"></span>
	</div>
</div>
<script type="text/javascript">
// 当前文章ID
window.arcIdRaw = 'a_' + 443;
window.arcId = "c550Q8guUG2S0KSkV9dUX0fxPmQGR/uhoS/n7yPtBE6TPispuvynPHZlhw";
window.siteId = 1;
window.cmsTempletsVer = "1.2";
</script>
<div id="footer">
	<ul id="nav-bottom" class="clearfix">
		<li><a href="/view/267.html" target="_blank">联系方式</a></li>
		<li><a href="/view/212.html" target="_blank">购买教程（带答疑）</a></li>
		<li><a href="/sitemap/" target="_blank">最近更新</a></li>
	</ul>
</div>

<script src="/templets/default/script/jquery1.12.4.min.js"></script>
<script src="/templets/default/script/jquery.snippet.js"></script>
<script src="/templets/default/script/common.js?v=1.2"></script>

<span style="display:none;"><script src="https://s22.cnzz.com/z_stat.php?id=1273514649&web_id=1273514649" language="JavaScript"></script></span>
</body>
</html>